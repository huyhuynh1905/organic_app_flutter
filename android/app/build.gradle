plugins {
    id "com.android.application"
    id "org.jetbrains.kotlin.android"
    id "dev.flutter.flutter-gradle-plugin"
}

def localProperties = new Properties()
def localPropertiesFile = rootProject.file("local.properties")
if (localPropertiesFile.exists()) {
    localPropertiesFile.withReader("UTF-8") { reader ->
        localProperties.load(reader)
    }
}

def flutterVersionCode = localProperties.getProperty("flutter.versionCode") ?: "1"
def flutterVersionName = localProperties.getProperty("flutter.versionName") ?: "1.0"

android {
    namespace "com.huyhuynh.organic"
    compileSdk = 35   // ✅ AGP 8 dùng `compileSdk` thay cho `compileSdkVersion`

    compileOptions {
        sourceCompatibility JavaVersion.VERSION_1_8
        targetCompatibility JavaVersion.VERSION_1_8
    }

    kotlinOptions {
        jvmTarget = "1.8"
    }

    sourceSets {
        main.java.srcDirs += "src/main/kotlin"
    }

    defaultConfig {
        applicationId "com.huyhuynh.organic"
        minSdk = 21             // ✅ không còn dùng `flutter.minSdkVersion` trực tiếp ở đây
        targetSdk = 35          // ✅ thay targetSdkVersion bằng targetSdk
        versionCode flutterVersionCode.toInteger()
        versionName flutterVersionName
    }

    buildTypes {
        release {
            signingConfig signingConfigs.debug
        }
    }

    flavorDimensions "environment"
    productFlavors {
        development {
            dimension "environment"
            versionCode flutterVersionCode.toInteger()
            versionName flutterVersionName
            versionNameSuffix "-dev"
        }
        uat {
            dimension "environment"
            versionCode flutterVersionCode.toInteger()
            versionName flutterVersionName
            versionNameSuffix "-uat"
        }
        production {
            dimension "environment"
            versionCode flutterVersionCode.toInteger()
            versionName flutterVersionName
            versionNameSuffix "-prod"
        }
    }
}
